environments:
  default:
    secrets:
      - ../globals.sops.yaml
      - default.sops.yaml
---
releases:
  - name: vaultwarden-cnpg
    chart: ../../charts/cnpg-cluster
    values:
      - release: 15
      - minio:
          accessKey: "{{ .Values.minio.cnpg.accessKey }}"
          secretKey: "{{ .Values.minio.cnpg.secretKey }}"
  - name: vaultwarden
    chart: ../../charts/vaultwarden
    values:
      - cnpg:
          name: vaultwarden-cnpg
      - config:
          signupsAllowed: false
          adminToken: "{{ .Values.adminToken }}"
      - smtp:
          enabled: true
          from: "{{ .Values.smtp.from }}"
          fromName: Vaultwarden Japan7
          host: "{{ .Values.smtp.host }}"
          user: "{{ .Values.smtp.user }}"
          password: "{{ .Values.smtp.password }}"
      - ldap:
          enabled: true
          host: openldap.openldap
          dn: "{{ .Values.ldap.admin.dn }}"
          password: "{{ .Values.ldap.admin.password }}"
          searchBaseDn: ou=users,{{ .Values.ldap.domain }}
      - ingress:
          host: vaultwarden.{{ .Values.domain }}
