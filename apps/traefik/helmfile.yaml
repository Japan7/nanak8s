environments:
  default:
    secrets:
      - ../globals.sops.yaml
      - default.sops.yaml
---
releases:
  - name: traefik-extras
    chart: ../../charts/traefik-extras
    values:
      - domain: "{{ .Values.domain }}"
      - traefik:
          letsencryptEmail: "{{ .Values.traefik.letsencryptEmail }}"
          extraPorts:
            - name: forgejo-ssh
              port: 8022
            - name: syncplay
              port: 8999
      - persistence:
          labels:
            recurring-job.longhorn.io/source: enabled
            recurring-job-group.longhorn.io/default: enabled
            recurring-job.longhorn.io/longhorn-backup: enabled
      - japan7BasicAuth:
          username: "{{ .Values.japan7BasicAuth.username }}"
          password: "{{ .Values.japan7BasicAuth.password }}"
  - name: traefik-forward-auth-japan7
    chart: ../../charts/traefik-forward-auth
    values:
      - image:
          repository: ghcr.io/japan7/traefik-forward-auth
          tag: master@sha256:5bf1bad2a63f6108ff03ba962ad53d81ee90e864f7cf5f36b5503bcb918f490b # renovate: repository=ghcr.io/japan7/traefik-forward-auth
      - secret: "{{ .Values.forwardAuth.secret }}"
      - encryptionKey: "{{ .Values.forwardAuth.encryptionKey }}"
      - keycloak:
          host: keycloak.{{ .Values.domain }}
          realm: japan7
          client:
            id: "{{ .Values.keycloak.japan7.id }}"
            secret: "{{ .Values.keycloak.japan7.token }}"
  - name: traefik-forward-auth-nanak8s
    chart: ../../charts/traefik-forward-auth
    values:
      - image:
          repository: ghcr.io/japan7/traefik-forward-auth
          tag: master@sha256:5bf1bad2a63f6108ff03ba962ad53d81ee90e864f7cf5f36b5503bcb918f490b # renovate: repository=ghcr.io/japan7/traefik-forward-auth
      - secret: "{{ .Values.forwardAuth.secret }}"
      - encryptionKey: "{{ .Values.forwardAuth.encryptionKey }}"
      - keycloak:
          host: keycloak.{{ .Values.domain }}
          realm: nanak8s
          client:
            id: "{{ .Values.keycloak.nanak8s.id }}"
            secret: "{{ .Values.keycloak.nanak8s.token }}"
