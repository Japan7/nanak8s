environments:
  prod:
    values:
      - tag: latest@sha256:b3c3056d72265fe82f81825e5652ccfc0a60c45397d65e3febb9904ab8b31f2d
      - tasks: true
      - affinity:
          podAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
              - weight: 100
                podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                      - key: app.kubernetes.io/name
                        operator: In
                        values:
                          - edgedb
                      - key: app.kubernetes.io/instance
                        operator: In
                        values:
                          - nanadb
                      - key: app.kubernetes.io/component
                        operator: In
                        values:
                          - db
                      - key: app.kubernetes.io/part-of
                        operator: In
                        values:
                          - edgedb
                  topologyKey: kubernetes.io/hostname
                  namespaceSelector: {}
    secrets:
      - ../globals.sops.yaml
      - prod.sops.yaml
  staging:
    values:
      - tag: main@sha256:1923f1bf4bb70590a26b33dae7ec264fa17f6165bc3454986bb41ac0d058c365
      - tasks: false
      - affinity: {}
    secrets:
      - ../globals.sops.yaml
      - staging.sops.yaml
  dev:
    values:
      - tag: break-reference-cycles@sha256:c2da0b2e078ae58955212c73b2d9a6f489a816d22e39f938e0fa65d6fa9f7bd5
      - tasks: false
      - affinity: {}
    secrets:
      - ../globals.sops.yaml
      - dev.sops.yaml
