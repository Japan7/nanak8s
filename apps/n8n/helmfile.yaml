environments:
  default:
    secrets:
      - ../shared.sops.yaml
      - default.sops.yaml
---
repositories:
  - name: open-8gears
    url: https://8gears.container-registry.com/chartrepo/library/

releases:
  - name: n8n
    chart: open-8gears/n8n
    namespace: n8n
    values:
      - n8n:
          encryption_key: "{{ .Values.encryptionKey }}"
      - extraEnv:
          WEBHOOK_TUNNEL_URL: "https://n8n.{{ .Values.domain }}"
      - config:
          host: n8n.{{ .Values.domain }}
      - persistence:
          enabled: true
          type: dynamic
      - ingress:
          enabled: true
          annotations:
            traefik.ingress.kubernetes.io/router.entrypoints: websecure
            traefik.ingress.kubernetes.io/router.middlewares: kube-system-admin-basic-auth@kubernetescrd
          hosts:
            - host: n8n.{{ .Values.domain }}
              paths:
                - /
