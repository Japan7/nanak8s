bases:
  - environments.yaml
---
releases:
  - name: producer
    chart: ../../charts/producer
    values:
      - upload:
          baseUrl: https://producer.{{ .Values.domain }}
          adminToken: "{{ .Values.producer.token }}"
      - s3:
          endpoint: garage-proxy:3900
          keyId: "{{ .Values.producer.keyId }}"
          secret: "{{ .Values.producer.secret }}"
      - ingress:
          host: producer.{{ .Values.domain }}
          annotations:
            traefik.ingress.kubernetes.io/router.entrypoints: websecure
            cert-manager.io/cluster-issuer: letsencrypt
  - name: garage-extras
    chart: ../../charts/garage-extras
    values:
      - garage:
          addresses: {{ .Values.garage.addresses | toYaml | nindent 12 }}
      - ingress:
          host: garage.{{ .Values.domain }}
          annotations:
            traefik.ingress.kubernetes.io/router.entrypoints: websecure
            cert-manager.io/cluster-issuer: letsencrypt
