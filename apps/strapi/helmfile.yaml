environments:
  default:
    values:
      - tag: sha-9e6d37e
    secrets:
      - ../globals.sops.yaml
      - default.sops.yaml
---
releases:
  - name: strapi-cnpg
    chart: ../../charts/cnpg-cluster
    values:
      - release: 15
      - backups:
          minio:
            endpoint: https://minio.{{ .Values.domain }}
            accessKey: "{{ .Values.cnpg.minio.accessKey }}"
            secretKey: "{{ .Values.cnpg.minio.secretKey }}"
  - name: strapi
    chart: ../../charts/strapi
    values:
      - image:
          repository: git.{{ .Values.domain }}/japan7/strapi-japan7
          tag: "{{ .Values.tag }}"
          pullSecrets:
            - forgejo-regcred
      - cnpg:
          name: strapi-cnpg
      - secret:
          appKeys: "{{ .Values.appKeys }}"
          apiTokenSalt: "{{ .Values.apiTokenSalt }}"
          adminJwtSecret: "{{ .Values.adminJwtSecret }}"
          jwtSecret: "{{ .Values.jwtSecret }}"
          transferTokenSalt: "{{ .Values.transferTokenSalt }}"
      - ingress:
          host: strapi.{{ .Values.domain }}
