environments:
  default:
    secrets:
      - ../shared.sops.yaml
---
repositories:
  - name: rook-release
    url: https://charts.rook.io/release

releases:
  - name: rook-ceph
    chart: rook-release/rook-ceph
    namespace: rook-ceph
  - name: rook-ceph-cluster
    chart: rook-release/rook-ceph-cluster
    namespace: rook-ceph
    values:
      - cluster.yaml
      - operatorNamespace: rook-ceph
      - ingress:
          dashboard:
            host:
              name: "ceph.{{ .Values.domain }}"
          annotations:
            traefik.ingress.kubernetes.io/router.entrypoints: websecure
    hooks:
      - events: ["prepare"]
        showlogs: true
        command: "kubectl"
        args: ["apply", "-f", "crds.yaml"]
